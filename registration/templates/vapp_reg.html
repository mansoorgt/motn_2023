{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>MOTN 2023</title>
  
  <!-- Bootstrap CSS -->
  <link rel="icon" type="image/x-icon" href="{% static 'img/motn/favicon.jfif' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link rel="stylesheet" href="{% static 'css/registration-mystyle.css' %}?update=1" >

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@900&display=swap" rel="stylesheet">

<style>

@font-face {
      font-family: 'montbold'; /* Give your font a name */
      src: url("{% static 'font/FontsFree-Net-Mont-Bold.ttf' %}") format('truetype'); /* Specify the path to your .ttf file */
    }

    body {
      font-family: 'montbold' !important; /* Apply the custom font to the body or any other element */
    }

</style>

</head>
<body style=" font-family: 'montbold' !important;">


  <div class="reg_background-image"></div>

  <header>
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container justify-content-center">
        <a class="navbar-brand" href="#">
          <img class="logo_img" src="{% static 'img/motn/logo.png' %}" width="170" height="60" alt="logo union">
        </a>
    
      </div>
    </nav>
  </header>

  <div class="container">
    <div class="row justify-content-center">


      <div class="col-md-8">
  
<div class="card mt-5 mb-5" style="border: 1px solid rgb(53, 135, 190);">

<div class="vappcard-head">
<h3 class="text-center text-black">
  REGISTER FOR VAPP PASS
</h3>
</div>
<div class="vapp_form p-2">

  <form id="vapp-form">
<div class="row">
<div class="col-md-6 mt-2">
<label>FIRST NAME</label>
<input type="text" class="form-control" name="first-name" required>
</div>

<div class="col-md-6 mt-2">
<label>LAST NAME</label>
<input type="text" class="form-control" name="last-name" required>
</div>
<div class="col-md-6 mt-2">
<label>MOBILE</label>
<input type="text" class="form-control" name="mobile" placeholder="+971 XXXXXXXX" required>
</div>

<div class="col-md-6 mt-2">
  <label>EMAIL</label>
  <input type="text" class="form-control" name="email" required>
  </div>

  <div class="col-md-6 mt-2">
    <label>VEHICLE PLATE NUMBER</label>
    <input type="text" class="form-control" name="vehicle-plate-number" required>
    </div>

    <div class="col-md-6 mt-2">
      <label>COMPANY NAME</label>
      <input type="text" class="form-control" name="company" required>
      </div>

      <div class="col-md-6 mt-2">
        <label>EVENT LOCATION</label>
        <br>
        {% for loc in locations %}
        <label class="evnt_text" style="margin-left: 8px;" for="">{{loc.name}}</label>
        <input  type="checkbox" value="{{loc.id}}" class="locations extra-validation" >
      
        {% endfor %}
        <br>
        <span class="locations-not-valid d-none ml-2" style="color: rgb(255, 0, 0);">Select any one </span>

        </div>

      <div class="col-md-6 mt-2">
        <label>CATEGORY</label>
        <select class="form-select" name="card-type" required>
          <option value="" disabled selected>Select Card Type</option>
          {% for type in cardtypes %}
          <option value="{{type.id}}">{{type.name}}</option>
          {% endfor %}
        </select>
        </div>

  

        <div class="col-md-6 mt-2">
<label>VEHICLE TYPE</label>
<select class="form-select" name="vehicle-type" required>
  <option value="" disabled selected>Select Vehicle Type</option>
  {% for type in vehicletype %}
  <option value="{{type.id}}">{{type.name}}</option>
  {% endfor %}
</select>
        </div>


        <div class="col-md-6 mt-2">
<label>VEHICLE PASS/MULKIYA</label>
<input type="file" class="form-control" name="vehicle-pass" required accept="image/*">
<div class="text-mute" style="font-size: 10px; color: rgba(0, 0, 0, 0.589);" >
  <span class="ml-3">*ONLY JPEG FORMAT</span>
                                      </div>       
</div>

        <div class="col-md-6 mt-2">
          <label>UPLOAD EMIRATES ID FRONT</label>
          <input type="file" class="form-control" name="id-proof-front-file" accept="image/*" required>
          <div class="text-mute" style="font-size: 10px; color: rgba(0, 0, 0, 0.589);">
            <span class="ml-3">*ONLY JPEG FORMAT</span>
                                                </div>      
        
        </div>

                  <div class="col-md-6 mt-2">
                    <label>UPLOAD EMIRATES ID BACK</label>
                    <input type="file" class="form-control" name="id-proof-back-file" accept="image/*" required>
                    <div class="text-mute" style="font-size: 10px; color: rgba(0, 0, 0, 0.589);">
                      <span class="ml-3">*ONLY JPEG FORMAT</span>
                                                          </div>        
                  </div>
                            <div class="col-md-6 mt-2">
                              <label>EMIRATES ID EXPIRY DATE</label>
                              <input type="date" class="form-control expiry-check extra-validation" name="id-expiry-date" required>
                              <span class="id-expiry-date-is-not-valid d-none ml-2" style="color: rgb(255, 0, 0);">  Expired </span>
                                      </div>

                                      <div class="col-md-6 mt-2">
                                        <label>DELIVERY DATE</label>
                                        <input type="date" class="form-control" name="delivery-date" required>
                                                </div>


                                                
                                                <div class="col-md-6">
                                                 
<button type="submit" class="evnt_button">SUBMIT  <div class="spinner-border spinner-border-sm  form-spinner d-none" role="status"></div></button>
</div>  
<div class="col-md-6">
                                                 
  <button type="reset" class="rst_button">RESET</button>
  </div>  
                                                


</div>
</form>
</div>


</div>



      </div>

    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
  <img class="footer_img"  src="{% static 'img/motn/footer_bg.png' %}" >
    </div>
  
  </div>

  <!-- Bootstrap JS and Popper.js (Optional) -->
  <script src="https://unpkg.com/cropperjs/dist/cropper.js"></script>
  <!-- Bootstrap JS and Popper.js (Optional) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
  <script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

  <script>

$('#vapp-form').submit(function (event){
      
   

      event.preventDefault()


      if (ExtravalidationPass() == false){
        return false
      }

      $(':submit').attr('disabled',true)
      $('.form-spinner').removeClass('d-none')
      var _formData=new FormData($(event.target)[0])
      _formData.append('locations',JSON.stringify($('.locations:checked').map( function(){return this.value }).get()))
      _formData.append('csrfmiddlewaretoken','{{ csrf_token }}')
      
      $.ajax({
        type: "POST",
        url: "{% url 'submit-vapp-registration' %}",
        data: _formData,
        contentType:false,
        processData:false,
        dataType: "json",
        success: function (response) {
          
          if(response.success){
         

            sendSuccessMail(response.id)

                setTimeout(() => {
                
                  window.location.href="{% url 'success-page' %}?reg-form=vapp"
                  // $(event.target)[0].reset()
                  $('.submit-btn-loading').addClass('d-none')

                  $(':submit').attr('disabled',false)

                }, 2000);

          }else{
            alert(response.reason)
          }

          
        }
      });
    })

    function sendSuccessMail(id){
      $.ajax({
        type: "POST",
        url: "{% url 'send-success-mail' %}",
        data: {id:id,'table-name':'vapp','csrfmiddlewaretoken':'{{csrf_token}}'},
        dataType: "json",
        success: function (response) {
          
        }
      });
    }


    $('.extra-validation').change(function () {
      ExtravalidationPass()
    })


     function ExtravalidationPass() {

      var fail_count=0
      
      // $('.locations:checked').each(function() {
      //   console.log($(this).val())
      // })
      
      if (!$('.locations:checked').length){
        $('.locations').focus()
        $('.locations-not-valid').removeClass('d-none')
        fail_count++
      } else{
        $('.locations-not-valid').addClass('d-none')
        
      }
      
  
      var expiryDate = new Date($('.expiry-check').val());
      var currentDate = new Date();
  
      if ( expiryDate <=currentDate ){
        $('.expiry-check').addClass('is-invalid')
        $('.id-expiry-date-is-not-valid').removeClass('d-none')
        fail_count ++
  
      } 
      else{
        $('.expiry-check').removeClass('is-invalid')
        $('.id-expiry-date-is-not-valid').addClass('d-none')
        
      }
   
      if (fail_count >= 1){
        
        return false
        
      }
      else{
      
        return true
      }

        }

        
  </script>

  
</body>
</html>